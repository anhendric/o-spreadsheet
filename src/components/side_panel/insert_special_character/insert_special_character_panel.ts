import { _t } from "@odoo/o-spreadsheet-engine/translation";
import { SpreadsheetChildEnv } from "@odoo/o-spreadsheet-engine/types/spreadsheet_env";
import { Component } from "@odoo/owl";
import { Section } from "../components/section/section";

const CHARACTERS = {
  [_t("Math")]: [
    "∑",
    "∫",
    "√",
    "∞",
    "≠",
    "±",
    "×",
    "÷",
    "≈",
    "≤",
    "≥",
    "∂",
    "∇",
    "∏",
    "∐",
    "∝",
    "∠",
    "∧",
    "∨",
    "∩",
    "∪",
    "≡",
    "‰",
    "∀",
    "∃",
    "∈",
    "∉",
    "⊂",
    "⊃",
    "⊆",
    "⊇",
    "½",
    "⅓",
    "⅔",
    "¼",
    "¾",
    "⅕",
    "⅖",
    "⅗",
    "⅘",
    "⅙",
    "⅚",
    "⅛",
    "⅜",
    "⅝",
    "⅞",
  ],
  [_t("Greek Lower")]: [
    "α",
    "β",
    "γ",
    "δ",
    "ε",
    "ζ",
    "η",
    "θ",
    "ι",
    "κ",
    "λ",
    "μ",
    "ν",
    "ξ",
    "ο",
    "π",
    "ρ",
    "σ",
    "τ",
    "υ",
    "φ",
    "χ",
    "ψ",
    "ω",
  ],
  [_t("Greek Upper")]: [
    "Α",
    "Β",
    "Γ",
    "Δ",
    "Ε",
    "Ζ",
    "Η",
    "Θ",
    "Ι",
    "Κ",
    "Λ",
    "Μ",
    "Ν",
    "Ξ",
    "Ο",
    "Π",
    "Ρ",
    "Σ",
    "Τ",
    "Υ",
    "Φ",
    "Χ",
    "Ψ",
    "Ω",
  ],
  [_t("Cyrillic Upper")]: [
    "А",
    "Б",
    "В",
    "Г",
    "Д",
    "Е",
    "Ё",
    "Ж",
    "З",
    "И",
    "Й",
    "К",
    "Л",
    "М",
    "Н",
    "О",
    "П",
    "Р",
    "С",
    "Т",
    "У",
    "Ф",
    "Х",
    "Ц",
    "Ч",
    "Ш",
    "Щ",
    "Ъ",
    "Ы",
    "Ь",
    "Э",
    "Ю",
    "Я",
  ],
  [_t("Cyrillic Lower")]: [
    "а",
    "б",
    "в",
    "г",
    "д",
    "е",
    "ё",
    "ж",
    "з",
    "и",
    "й",
    "к",
    "л",
    "м",
    "н",
    "о",
    "п",
    "р",
    "с",
    "т",
    "у",
    "ф",
    "х",
    "ц",
    "ч",
    "ш",
    "щ",
    "ъ",
    "ы",
    "ь",
    "э",
    "ю",
    "я",
  ],
  [_t("Currency")]: [
    "€",
    "£",
    "¥",
    "¢",
    "$",
    "₽",
    "₹",
    "₩",
    "₪",
    "฿",
    "₫",
    "₴",
    "₵",
    "₭",
    "₮",
    "₱",
    "₲",
    "₳",
    "₯",
    "₠",
  ],
  [_t("Punctuation & Symbols")]: [
    "©",
    "®",
    "™",
    "§",
    "¶",
    "†",
    "‡",
    "•",
    "°",
    "‰",
    "¿",
    "¡",
    "«",
    "»",
    "“",
    "”",
    "‘",
    "’",
    "–",
    "—",
    "…",
    "¬",
    "µ",
    "¦",
  ],
  [_t("Arrows")]: ["←", "↑", "→", "↓", "↔", "↕", "↖", "↗", "↘", "↙", "⇐", "⇑", "⇒", "⇓", "⇔", "⇕"],
  [_t("Geometric Shapes")]: [
    "■",
    "□",
    "▲",
    "△",
    "▼",
    "▽",
    "◆",
    "◇",
    "●",
    "○",
    "★",
    "☆",
    "♠",
    "♣",
    "♥",
    "♦",
  ],
};

export class InsertSpecialCharacterPanel extends Component<{}, SpreadsheetChildEnv> {
  static template = "o-spreadsheet-InsertSpecialCharacterPanel";
  static components = { Section };
  static props = {
    onCloseSidePanel: Function,
  };

  categories = CHARACTERS;

  onMousedown(ev: MouseEvent) {
    // Prevent focus loss when clicking on the buttons
    ev.preventDefault();
  }

  onCharacterClick(char: string) {
    // If content editable is focused (Composer), insert text directly
    if (
      document.activeElement &&
      (document.activeElement.classList.contains("o-composer") ||
        document.activeElement.getAttribute("contenteditable") === "true" ||
        document.activeElement.getAttribute("contenteditable") === "plaintext-only")
    ) {
      (document as any).execCommand("insertText", false, char);
      return;
    }

    // Otherwise, insert into the selected cell
    const getters = this.env.model.getters;
    const sheetId = getters.getActiveSheetId();
    const { col, row } = getters.getActivePosition();
    const cell = getters.getCell({ sheetId, col, row });
    const content = cell ? cell.content || "" : "";

    this.env.model.dispatch("UPDATE_CELL", {
      sheetId,
      col,
      row,
      content: content + char,
    });
  }
}
